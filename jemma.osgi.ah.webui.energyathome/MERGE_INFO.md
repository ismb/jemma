Completely imported from 3.3.0
